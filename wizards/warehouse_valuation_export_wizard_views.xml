<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Vue formulaire du wizard -->
    <record id="view_warehouse_valuation_export_wizard_form" model="ir.ui.view">
        <field name="name">stockex.warehouse.valuation.export.wizard.form</field>
        <field name="model">stockex.warehouse.valuation.export.wizard</field>
        <field name="arch" type="xml">
            <form string="Export Valorisation par Entrep√¥t">
                <header>
                    <button name="action_export" string="G√©n√©rer Excel" type="object" 
                            class="btn-primary" invisible="state == 'done'"/>
                    <button name="action_download" string="T√©l√©charger" type="object" 
                            class="btn-success" invisible="state != 'done'"/>
                    <button name="action_back" string="Nouvelle Export" type="object" 
                            class="btn-secondary" invisible="state != 'done'"/>
                    <button string="Annuler" special="cancel" class="btn-secondary"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,done"/>
                </header>
                
                <sheet>
                    <!-- Configuration -->
                    <div invisible="state == 'done'">
                        <div class="oe_title">
                            <h1>
                                <i class="fa fa-file-excel-o text-success"/> Export Excel - Valorisation par Entrep√¥t
                            </h1>
                        </div>
                        
                        <group>
                            <group string="üîç Filtres">
                                <field name="warehouse_ids" widget="many2many_tags" 
                                       placeholder="Tous les entrep√¥ts"
                                       options="{'color_field': 'color', 'no_create': True}"/>
                                <field name="date_from"/>
                                <field name="date_to"/>
                                <field name="category_ids" widget="many2many_tags"
                                       placeholder="Toutes les cat√©gories"
                                       options="{'color_field': 'color', 'no_create': True}"/>
                            </group>
                            
                            <group string="üìä Options d'Export">
                                <field name="export_type" widget="radio"/>
                                <field name="include_vsd"/>
                                <field name="include_ecarts"/>
                            </group>
                        </group>
                        
                        <div class="alert alert-info mt-3" role="status">
                            <strong><i class="fa fa-info-circle"/> Types d'export :</strong>
                            <ul class="mb-0 mt-2">
                                <li><strong>R√©sum√© par Entrep√¥t</strong> : Vue synth√©tique avec totaux par entrep√¥t</li>
                                <li><strong>D√©taill√© par Produit</strong> : Une feuille par entrep√¥t avec d√©tail produit par produit</li>
                                <li><strong>Les Deux</strong> : R√©sum√© + d√©tails dans un seul fichier Excel</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- R√©sultat -->
                    <div invisible="state != 'done'">
                        <div class="alert alert-success" role="status">
                            <h3 class="mb-3">
                                <i class="fa fa-check-circle"/> Export G√©n√©r√© avec Succ√®s !
                            </h3>
                            <div class="row">
                                <div class="col-md-6">
                                    <p class="mb-2">
                                        <strong>Fichier :</strong> 
                                        <field name="export_filename" readonly="1" class="oe_inline"/>
                                    </p>
                                    <p class="mb-2">
                                        <strong>Type :</strong> 
                                        <field name="export_type" readonly="1" class="oe_inline"/>
                                    </p>
                                </div>
                                <div class="col-md-6">
                                    <p class="mb-2">
                                        <strong>Entrep√¥ts :</strong> 
                                        <field name="warehouse_ids" readonly="1" widget="many2many_tags" class="oe_inline"/>
                                    </p>
                                    <p class="mb-2" invisible="not date_from and not date_to">
                                        <strong>P√©riode :</strong> 
                                        <field name="date_from" readonly="1" class="oe_inline"/> ‚Üí 
                                        <field name="date_to" readonly="1" class="oe_inline"/>
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-center mt-4">
                            <field name="export_file" filename="export_filename" invisible="1"/>
                            <i class="fa fa-file-excel-o fa-5x text-success mb-3" title="Exporter Excel"/>
                            <h4>Votre fichier Excel est pr√™t !</h4>
                            <p class="text-muted">Cliquez sur "T√©l√©charger" pour l'enregistrer</p>
                        </div>
                    </div>
                </sheet>
                
                <footer invisible="state == 'done'">
                    <span class="text-muted">
                        <i class="fa fa-lightbulb-o"/> Astuce : Laissez les filtres vides pour exporter tous les entrep√¥ts
                    </span>
                </footer>
            </form>
        </field>
    </record>
    
    <!-- Action pour ouvrir le wizard -->
    <record id="action_warehouse_valuation_export_wizard" model="ir.actions.act_window">
        <field name="name">Export Excel - Valorisation Entrep√¥ts</field>
        <field name="res_model">stockex.warehouse.valuation.export.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="binding_model_id" ref="model_stockex_inventory_summary"/>
    </record>
</odoo>
