<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- Vue formulaire des catégories avec code et comptes comptables -->
    <record id="product_category_form_view_inherit" model="ir.ui.view">
        <field name="name">product.category.form.inherit.stockex</field>
        <field name="model">product.category</field>
        <field name="inherit_id" ref="product.product_category_form_view"/>
        <field name="arch" type="xml">
            <field name="name" position="after">
                <field name="code" placeholder="ex: ALIM, ELEC, FOUR..." 
                       help="Code court pour identifier la catégorie"/>
            </field>
            <field name="parent_id" position="after">
                <field name="accounts_configured" 
                       widget="boolean" 
                       readonly="1"
                       string="✓ Comptes Comptables Configurés"/>
            </field>
        </field>
    </record>
    
    <!-- Vue liste des catégories avec code -->
    <record id="product_category_list_view_inherit" model="ir.ui.view">
        <field name="name">product.category.list.inherit.stockex</field>
        <field name="model">product.category</field>
        <field name="inherit_id" ref="product.product_category_list_view"/>
        <field name="arch" type="xml">
            <field name="display_name" position="after">
                <field name="code" optional="show"/>
                <field name="accounts_configured" string="✓ Comptes Config." 
                       widget="boolean_toggle" 
                       optional="show"
                       readonly="1"/>
            </field>
        </field>
    </record>
    
    <!-- Vue Kanban pour Catégories (style entrepôts) -->
    <record id="product_category_kanban_stockex" model="ir.ui.view">
        <field name="name">product.category.kanban.stockex</field>
        <field name="model">product.category</field>
        <field name="priority">1</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile">
                <field name="id"/>
                <field name="name"/>
                <field name="code"/>
                <field name="parent_id"/>
                <field name="accounts_configured"/>
                <field name="product_count"/>
                <templates>
                    <t t-name="card">
                        <div class="oe_kanban_card oe_kanban_global_click rounded" t-att-class="record.accounts_configured.raw_value ? 'bg-light border-start border-3 border-success' : 'bg-light border-start border-3 border-warning'">
                            <div class="o_dropdown_kanban dropdown">
                                <a class="dropdown-toggle o-no-caret btn" role="button" data-bs-toggle="dropdown" href="#" aria-label="Dropdown menu" title="Menu">
                                    <span class="fa fa-ellipsis-v"/>
                                </a>
                                <div class="dropdown-menu" role="menu">
                                    <a role="menuitem" type="open" class="dropdown-item">Ouvrir</a>
                                    <a role="menuitem" type="edit" class="dropdown-item">Modifier</a>
                                </div>
                            </div>
                            <div class="oe_kanban_content px-3 py-1 position-relative">
                                <!-- Image en filigrane -->
                                <img src="/stockex/static/description/category_watermark.svg" 
                                     class="position-absolute opacity-25" 
                                     style="width: 120px; height: 120px; right: -10px; top: 50%; transform: translateY(-50%); z-index: 0; object-fit: contain;"
                                     alt="Catégorie"/>
                                <div class="oe_kanban_card_header position-relative" style="z-index: 1;">
                                    <div class="oe_kanban_card_header_title mb-0">
                                        <span class="fa fa-folder-open fa-lg text-primary me-1" title="Catégorie"/> 
                                        <strong t-if="record.code.raw_value"><field name="code"/></strong>
                                        <span t-if="record.code.raw_value"> - </span>
                                        <field name="name"/>
                                    </div>
                                </div>
                                <div class="oe_kanban_card_body position-relative" style="z-index: 1;">
                                    <!-- Catégorie parente -->
                                    <div class="mb-0" t-if="record.parent_id.raw_value">
                                        <i class="fa fa-sitemap fa-lg text-info me-1" title="Catégorie parente"/> 
                                        <span><field name="parent_id"/></span>
                                    </div>
                                    <div class="mb-0" t-else="">
                                        <i class="fa fa-layer-group fa-lg text-warning me-1" title="Catégorie racine"/> 
                                        <span class="badge bg-warning text-dark">Catégorie racine</span>
                                    </div>
                                    
                                    <!-- Nombre de produits -->
                                    <div class="mb-0">
                                        <i class="fa fa-box-open fa-lg text-primary me-1"/>
                                        <strong>Produits:</strong> <field name="product_count"/> articles
                                    </div>
                                    
                                    <!-- Badges compacts -->
                                    <div class="d-flex gap-1 mb-0">
                                        <span class="badge rounded-pill text-bg-primary" title="Nombre de produits">
                                            <i class="fa fa-cubes me-1" title="Produits"/> <field name="product_count"/> art.
                                        </span>
                                        <span t-att-class="record.accounts_configured.raw_value ? 'badge rounded-pill text-bg-success' : 'badge rounded-pill text-bg-warning'" title="État comptes comptables">
                                            <i t-att-class="record.accounts_configured.raw_value ? 'fa fa-check-circle me-1' : 'fa fa-exclamation-triangle me-1'" title="Comptes"/> 
                                            <span t-if="record.accounts_configured.raw_value">Comptes OK</span>
                                            <span t-else="">Comptes à config.</span>
                                        </span>
                                    </div>
                                    
                                    <!-- Code catégorie (si existe) -->
                                    <div class="mb-0" t-if="record.code.raw_value">
                                        <i class="fa fa-barcode text-muted me-1"/> Code: <strong><field name="code"/></strong>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>
    
    <!-- Hériter de l'action par défaut Odoo pour ajouter le mode kanban -->
    <record id="product.product_category_action_form" model="ir.actions.act_window">
        <field name="view_mode">kanban,list,form</field>
    </record>
    
</odoo>
