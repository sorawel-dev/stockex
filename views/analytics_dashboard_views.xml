<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ========== VUES GRAPHIQUES NATIVES (d√©finies en premier) ========== -->
    
    <!-- Vue Graph: √âvolution des Inventaires -->
    <record id="view_inventory_graph_trend" model="ir.ui.view">
        <field name="name">stockex.stock.inventory.graph.trend</field>
        <field name="model">stockex.stock.inventory</field>
        <field name="arch" type="xml">
            <graph string="√âvolution des Inventaires" type="line" sample="1">
                <field name="date" interval="month"/>
                <field name="state"/>
            </graph>
        </field>
    </record>
    
    <!-- Vue Graph: Inventaires par √âtat -->
    <record id="view_inventory_graph_state" model="ir.ui.view">
        <field name="name">stockex.stock.inventory.graph.state</field>
        <field name="model">stockex.stock.inventory</field>
        <field name="arch" type="xml">
            <graph string="Inventaires par √âtat" type="bar" stacked="True">
                <field name="state"/>
            </graph>
        </field>
    </record>
    
    <!-- Vue Pivot: Analyse des Inventaires -->
    <record id="view_inventory_pivot" model="ir.ui.view">
        <field name="name">stockex.stock.inventory.pivot</field>
        <field name="model">stockex.stock.inventory</field>
        <field name="arch" type="xml">
            <pivot string="Analyse des Inventaires">
                <field name="date" interval="month" type="row"/>
                <field name="location_id" type="col"/>
                <field name="state" type="col"/>
            </pivot>
        </field>
    </record>
    
    <!-- Action: Graphiques des Inventaires -->
    <record id="action_inventory_analysis_graphs" model="ir.actions.act_window">
        <field name="name">Analyse Graphique des Inventaires</field>
        <field name="res_model">stockex.stock.inventory</field>
        <field name="view_mode">graph,pivot</field>
        <field name="domain">[]</field>
        <field name="context">{
            'search_default_this_year': 1,
        }</field>
    </record>
    
    <!-- ========== DASHBOARD ANALYTIQUE ========== -->
    
    <record id="view_analytics_dashboard_form" model="ir.ui.view">
        <field name="name">stockex.analytics.dashboard.form</field>
        <field name="model">stockex.analytics.dashboard</field>
        <field name="arch" type="xml">
            <form string="Dashboard Analytique" create="false" delete="false">
                <header>
                    <button name="action_refresh_kpis" string="üîÑ Actualiser" type="object" 
                            class="oe_highlight" style="font-weight: bold;"/>
                    <button name="action_view_inventories" string="üìã Voir Inventaires" type="object" 
                            class="btn-primary"/>
                    <field name="period" widget="selection" class="oe_inline"/>
                </header>
                <sheet style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);">
                    <div class="oe_title" style="text-align: center; padding: 20px 0; background: white; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 30px;">
                        <h1 style="color: #2c3e50; font-size: 32px; margin: 0;">
                            <i class="fa fa-chart-line" style="color: #3498db;"/> 
                            <span style="font-weight: 700;">Dashboard Analytique</span>
                        </h1>
                        <p style="color: #7f8c8d; margin-top: 10px; font-size: 14px;">Analyse en temps r√©el de vos inventaires</p>
                    </div>
                    
                    <!-- Filtres P√©riode -->
                    <group name="period_filter" invisible="period != 'custom'">
                        <group>
                            <field name="date_from"/>
                        </group>
                        <group>
                            <field name="date_to"/>
                        </group>
                    </group>
                    
                    <!-- KPIs Principaux -->
                    <div class="o_kanban_dashboard" style="padding: 20px;">
                        <div class="row" style="margin-bottom: 25px;">
                            <!-- KPI 1: Total Inventaires -->
                            <div class="col-md-4" style="padding: 10px;">
                                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 15px; box-shadow: 0 8px 16px rgba(102, 126, 234, 0.4); transition: transform 0.3s;">
                                    <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                        <i class="fa fa-cubes" style="font-size: 40px; margin-right: 15px; opacity: 0.8;"/>
                                        <div>
                                            <div style="font-size: 14px; opacity: 0.9; text-transform: uppercase; letter-spacing: 1px;">Total Inventaires</div>
                                            <div style="font-size: 36px; font-weight: bold; margin-top: 5px;">
                                                <field name="kpi_total_inventories"/>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.2);">
                                        <span style="background: rgba(255,255,255,0.2); padding: 5px 12px; border-radius: 20px; font-size: 13px;">
                                            ‚úÖ Valid√©s: <field name="kpi_completed_inventories"/>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- KPI 2: Pr√©cision -->
                            <div class="col-md-4" style="padding: 10px;">
                                <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 25px; border-radius: 15px; box-shadow: 0 8px 16px rgba(245, 87, 108, 0.4);">
                                    <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                        <i class="fa fa-bullseye" style="font-size: 40px; margin-right: 15px; opacity: 0.8;"/>
                                        <div>
                                            <div style="font-size: 14px; opacity: 0.9; text-transform: uppercase; letter-spacing: 1px;">Pr√©cision Moyenne</div>
                                            <div style="font-size: 36px; font-weight: bold; margin-top: 5px;">
                                                <field name="kpi_average_accuracy"/> %
                                            </div>
                                        </div>
                                    </div>
                                    <div style="padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.2);">
                                        <field name="kpi_average_accuracy" widget="progressbar" 
                                               options="{'current_value': 'kpi_average_accuracy', 'max_value': 100, 'editable': false}"
                                               style="height: 8px;"/>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- KPI 3: Valeur √âcarts -->
                            <div class="col-md-4" style="padding: 10px;">
                                <div style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); color: white; padding: 25px; border-radius: 15px; box-shadow: 0 8px 16px rgba(250, 112, 154, 0.4);">
                                    <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                        <i class="fa fa-money-bill-wave" style="font-size: 40px; margin-right: 15px; opacity: 0.8;"/>
                                        <div style="width: 100%;">
                                            <div style="font-size: 14px; opacity: 0.9; text-transform: uppercase; letter-spacing: 1px;">Valeur √âcarts</div>
                                            <div style="font-size: 28px; font-weight: bold; margin-top: 5px;">
                                                <field name="kpi_total_variance_value" widget="monetary"/>
                                                <field name="currency_id" invisible="1"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Seconde ligne KPIs -->
                        <div class="row">
                            <!-- KPI 4: Taux Rotation -->
                            <div class="col-md-4" style="padding: 10px;">
                                <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 20px; border-radius: 15px; box-shadow: 0 6px 12px rgba(79, 172, 254, 0.3);">
                                    <i class="fa fa-sync-alt" style="font-size: 28px; margin-bottom: 10px; opacity: 0.8;"/>
                                    <div style="font-size: 13px; opacity: 0.9; text-transform: uppercase;">Taux Rotation Stock</div>
                                    <div style="font-size: 28px; font-weight: bold; margin-top: 8px;">
                                        <field name="kpi_stock_turnover_ratio" widget="float"/> 
                                        <span style="font-size: 14px; opacity: 0.8;">fois/p√©riode</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- KPI 5: Produits -->
                            <div class="col-md-4" style="padding: 10px;">
                                <div style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white; padding: 20px; border-radius: 15px; box-shadow: 0 6px 12px rgba(67, 233, 123, 0.3);">
                                    <i class="fa fa-box" style="font-size: 28px; margin-bottom: 10px; opacity: 0.8;"/>
                                    <div style="font-size: 13px; opacity: 0.9; text-transform: uppercase;">Produits Inventori√©s</div>
                                    <div style="font-size: 28px; font-weight: bold; margin-top: 8px;">
                                        <field name="stat_total_products_counted"/>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- KPI 6: Emplacements -->
                            <div class="col-md-4" style="padding: 10px;">
                                <div style="background: linear-gradient(135deg, #fa8bff 0%, #2bd2ff 100%); color: white; padding: 20px; border-radius: 15px; box-shadow: 0 6px 12px rgba(250, 139, 255, 0.3);">
                                    <i class="fa fa-map-marker-alt" style="font-size: 28px; margin-bottom: 10px; opacity: 0.8;"/>
                                    <div style="font-size: 13px; opacity: 0.9; text-transform: uppercase;">Emplacements Couverts</div>
                                    <div style="font-size: 28px; font-weight: bold; margin-top: 8px;">
                                        <field name="stat_total_locations_covered"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Graphiques -->
                    <notebook style="margin-top: 30px;">
                        <page string="üìà Tendances" name="trends">
                            <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.08);">
                                <h3 style="color: #667eea; margin-bottom: 20px; font-size: 20px;">
                                    <i class="fa fa-chart-line"/> √âvolution des Inventaires
                                </h3>
                                <group>
                                    <group col="4" string="üìä R√©sum√© de la P√©riode">
                                        <field name="kpi_total_inventories" string="üì¶ Total Inventaires" 
                                               style="font-size: 16px; font-weight: bold; color: #667eea;"/>
                                        <field name="kpi_completed_inventories" string="‚úÖ Valid√©s"
                                               style="font-size: 16px; font-weight: bold; color: #43e97b;"/>
                                        <field name="stat_total_products_counted" string="üè∑Ô∏è Produits Compt√©s"
                                               style="font-size: 16px; font-weight: bold; color: #4facfe;"/>
                                        <field name="stat_total_locations_covered" string="üìç Emplacements"
                                               style="font-size: 16px; font-weight: bold; color: #fa8bff;"/>
                                    </group>
                                </group>
                                <separator string="Analyse Graphique" style="margin-top: 20px;"/>
                                <div style="margin: 20px 0; padding: 20px; background: linear-gradient(135deg, #667eea22 0%, #764ba222 100%); border-radius: 8px; text-align: center;">
                                    <p style="margin-bottom: 15px; color: #555; font-size: 14px;">
                                        <i class="fa fa-info-circle" style="color: #667eea;"/> 
                                        Visualisez l'√©volution mensuelle avec des graphiques interactifs
                                    </p>
                                    <button name="%(action_inventory_analysis_graphs)d" 
                                            string="üìä Ouvrir les Graphiques D√©taill√©s" 
                                            type="action" 
                                            class="btn-primary" 
                                            style="font-size: 15px; padding: 12px 30px; border-radius: 25px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; box-shadow: 0 4px 8px rgba(102, 126, 234, 0.4);"/>
                                </div>
                            </div>
                        </page>
                        
                        <page string="üí∞ Valorisation" name="valuation">
                            <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.08);">
                                <h3 style="color: #fa709a; margin-bottom: 20px; font-size: 20px;">
                                    <i class="fa fa-coins"/> Valorisation du Stock
                                </h3>
                                <group>
                                    <group string="üíé Valeur Totale du Stock">
                                        <field name="kpi_total_variance_value" widget="monetary" string="üí∞ Valeur des √âcarts"
                                               style="font-size: 18px; font-weight: bold; color: #fa709a;"/>
                                        <field name="currency_id" invisible="1"/>
                                    </group>
                                </group>
                                <separator string="R√©partition par Cat√©gorie" style="margin-top: 20px;"/>
                                <div style="margin: 20px 0; padding: 20px; background: linear-gradient(135deg, #fa709a22 0%, #fee14022 100%); border-radius: 8px; text-align: center;">
                                    <p style="margin-bottom: 15px; color: #555; font-size: 14px;">
                                        <i class="fa fa-chart-pie" style="color: #fa709a;"/> 
                                        Analysez la r√©partition de la valeur par cat√©gorie de produits
                                    </p>
                                    <button name="%(action_inventory_analysis_graphs)d" 
                                            string="üìä Ouvrir les Graphiques D√©taill√©s" 
                                            type="action" 
                                            class="btn-primary" 
                                            style="font-size: 15px; padding: 12px 30px; border-radius: 25px; background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); border: none; box-shadow: 0 4px 8px rgba(250, 112, 154, 0.4);"/>
                                </div>
                            </div>
                        </page>
                        
                        <page string="üìä √âcarts" name="variances">
                            <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.08);">
                                <h3 style="color: #f5576c; margin-bottom: 20px; font-size: 20px;">
                                    <i class="fa fa-exclamation-triangle"/> Analyse des √âcarts
                                </h3>
                                <group>
                                    <group col="2" string="‚ö†Ô∏è Indicateurs Cl√©s">
                                        <field name="kpi_total_variance_value" widget="monetary" string="üíµ Valeur Totale"
                                               style="font-size: 18px; font-weight: bold; color: #f5576c;"/>
                                        <field name="kpi_average_accuracy" widget="percentage" string="üéØ Pr√©cision Moyenne"
                                               style="font-size: 18px; font-weight: bold; color: #43e97b;"/>
                                    </group>
                                </group>
                                <separator string="D√©tails des √âcarts" style="margin-top: 20px;"/>
                                <div style="margin: 20px 0; padding: 20px; background: linear-gradient(135deg, #f093fb22 0%, #f5576c22 100%); border-radius: 8px; text-align: center;">
                                    <p style="margin-bottom: 15px; color: #555; font-size: 14px;">
                                        <i class="fa fa-chart-bar" style="color: #f5576c;"/> 
                                        Identifiez les cat√©gories avec les plus grands √©carts
                                    </p>
                                    <button name="%(action_inventory_analysis_graphs)d" 
                                            string="üìä Ouvrir les Graphiques D√©taill√©s" 
                                            type="action" 
                                            class="btn-primary" 
                                            style="font-size: 15px; padding: 12px 30px; border-radius: 25px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border: none; box-shadow: 0 4px 8px rgba(240, 147, 251, 0.4);"/>
                                </div>
                            </div>
                        </page>
                        
                        <page string="üìã Statistiques" name="stats">
                            <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.08);">
                                <h3 style="color: #4facfe; margin-bottom: 20px; font-size: 20px;">
                                    <i class="fa fa-chart-area"/> Statistiques D√©taill√©es
                                </h3>
                                <group>
                                    <group string="üìä Statistiques G√©n√©rales" style="background: linear-gradient(135deg, #4facfe11 0%, #00f2fe11 100%); padding: 15px; border-radius: 8px;">
                                        <field name="stat_total_products_counted" string="üè∑Ô∏è Produits Compt√©s"
                                               style="font-size: 16px; font-weight: bold; color: #4facfe;"/>
                                        <field name="stat_total_locations_covered" string="üìç Emplacements Couverts"
                                               style="font-size: 16px; font-weight: bold; color: #fa8bff;"/>
                                        <field name="stat_average_time_per_inventory" widget="float_time" string="‚è±Ô∏è Temps Moyen/Inventaire"
                                               style="font-size: 16px; font-weight: bold; color: #43e97b;"/>
                                    </group>
                                    <group string="üéØ Indicateurs de Performance" style="background: linear-gradient(135deg, #43e97b11 0%, #38f9d711 100%); padding: 15px; border-radius: 8px;">
                                        <field name="kpi_average_accuracy" widget="percentage" string="üéØ Pr√©cision Moyenne"
                                               style="font-size: 16px; font-weight: bold; color: #43e97b;"/>
                                        <field name="kpi_stock_turnover_ratio" string="üîÑ Taux de Rotation"
                                               style="font-size: 16px; font-weight: bold; color: #4facfe;"/>
                                        <field name="kpi_total_variance_value" widget="monetary" string="üí∞ Valeur √âcarts"
                                               style="font-size: 16px; font-weight: bold; color: #f5576c;"/>
                                    </group>
                                </group>
                                <div style="margin-top: 20px; padding: 20px; background: linear-gradient(135deg, #667eea11 0%, #764ba211 100%); border-radius: 8px; text-align: center;">
                                    <p style="color: #555; font-size: 14px; margin: 0;">
                                        <i class="fa fa-lightbulb" style="color: #667eea;"/> 
                                        <strong>Conseil :</strong> Ces statistiques sont mises √† jour en temps r√©el. Cliquez sur "üîÑ Actualiser" pour rafra√Æchir les donn√©es.
                                    </p>
                                </div>
                            </div>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>
    
    <!-- Action Dashboard -->
    <record id="action_analytics_dashboard" model="ir.actions.act_window">
        <field name="name">Dashboard Analytique</field>
        <field name="res_model">stockex.analytics.dashboard</field>
        <field name="view_mode">form</field>
        <field name="target">current</field>
        <field name="context">{
            'form_view_initial_mode': 'readonly',
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Dashboard Analytique Stockex
            </p>
            <p>
                Visualisez vos KPIs et analyses en temps r√©el.
            </p>
        </field>
    </record>

</odoo>
