<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Action pour la page d'accueil -->
    <record id="action_stockex_dashboard_home" model="ir.actions.act_window">
        <field name="name">Vue d'Ensemble</field>
        <field name="res_model">stockex.inventory.summary</field>
        <field name="view_mode">kanban</field>
        <field name="res_id" ref="inventory_summary_default"/>
        <field name="target">current</field>
        <field name="context">{'form_view_initial_mode': 'readonly'}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                üëã Bienvenue dans la Gestion d'Inventaire !
            </p>
            <p>
                Cr√©ez votre premier inventaire pour commencer √† g√©rer vos stocks.
            </p>
        </field>
    </record>
    
    <!-- Vue Kanban am√©lior√©e pour la page d'accueil avec Filtres -->
    <record id="view_inventory_summary_kanban_dashboard" model="ir.ui.view">
        <field name="name">stockex.inventory.summary.kanban.dashboard</field>
        <field name="model">stockex.inventory.summary</field>
        <field name="priority">1</field>
        <field name="arch" type="xml">
            <kanban create="false" edit="false" delete="false" class="o_kanban_dashboard o_stockex_dashboard">
                <field name="total_inventories"/>
                <field name="total_inventories_done"/>
                <field name="total_products_all"/>
                <field name="total_quantity_all"/>
                <field name="total_value_all"/>
                <field name="current_stock_value"/>
                <field name="current_stock_value_no_depreciation"/>
                <field name="initial_stock_date"/>
                <field name="company_currency_id"/>
                <field name="is_economic_valuation"/>
                <field name="stock_value_difference"/>
                <field name="stock_value_difference_percent"/>
                <field name="warehouse_valuation_html"/>
                <field name="inventoried_warehouse_valuation_html"/>
                <field name="last_inventory_id"/>
                <field name="last_inventory_date"/>
                <field name="last_inventory_products"/>
                <field name="last_inventory_value"/>
                <field name="top_categories_html"/>
                <field name="top_warehouses_html"/>
                <templates>
                    <t t-name="card">
                        <div class="oe_kanban_global_click o_stockex_dashboard_main">
                            
                            <!-- Header avec titre -->
                            <div class="o_kanban_card-header mb-4">
                                <div class="o_kanban_card-header_title">
                                    <div class="o_primary">
                                        <h3>‚ú® Vue d'Ensemble - Gestion d'Inventaire</h3>
                                    </div>
                                    <div class="o_secondary">
                                        üìä Stock actuel vs Stocks inventori√©s - Tableau de bord en temps r√©el
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Section 1: √âTAT DU STOCK ARR√äT√â (Stock Initial) -->
                            <div class="container o_kanban_card_content mt-4">
                                <div class="row">
                                    <div class="col-12 mb-4">
                                        <div class="card border-success">
                                            <div class="card-header bg-success text-white" style="overflow-x: auto;">
                                                <h5 class="mb-0" style="white-space: nowrap; font-size: 1.1rem;">üìä STOCK ARR√äT√â EN DATE DU <field name="initial_stock_date" widget="date"/></h5>
                                            </div>
                                            <div class="card-body">
                                                <div class="row">
                                                    <!-- Valeur Stock Actuel - Cards avec et sans d√©cote -->
                                                    <!-- Pleine page si Co√ªt standard, demi-page si Co√ªt √©conomique -->
                                                    <div t-attf-class="col-12 mb-4 #{record.is_economic_valuation.raw_value and 'col-md-6' or ''}">
                                                        <div class="card border-0 shadow-lg" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                                            <div class="card-body text-center py-5">
                                                                <div class="mb-3">
                                                                    <span class="display-1" style="filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));">üí∞</span>
                                                                </div>
                                                                <h5 class="text-white text-uppercase mb-3" style="letter-spacing: 2px; font-weight: 600;">Stock Initial (SANS D√©cote)</h5>
                                                                <div class="display-3 fw-bold text-white mb-3" style="text-shadow: 0 4px 12px rgba(0,0,0,0.3); font-size: 3.5rem;">
                                                                    <field name="current_stock_value_no_depreciation" widget="monetary" options="{'currency_field': 'company_currency_id', 'no_symbol': True}"/> FCFA
                                                                </div>
                                                                <div class="d-flex justify-content-center align-items-center gap-3">
                                                                    <span class="badge bg-white text-primary px-4 py-2 fs-6" style="border-radius: 50px;">üìä Valeur Th√©orique</span>
                                                                    <span class="badge bg-white bg-opacity-25 text-white px-4 py-2 fs-6" style="border-radius: 50px;">‚úì Prix de base</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- Stock Initial (AVEC D√©cote) - Visible uniquement si r√®gle = Co√ªt √©conomique -->
                                                    <div class="col-12 col-md-6 mb-4" t-if="record.is_economic_valuation.raw_value">
                                                        <div class="card border-0 shadow-lg" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                                                            <div class="card-body text-center py-5">
                                                                <div class="mb-3">
                                                                    <span class="display-1" style="filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));">üíµ</span>
                                                                </div>
                                                                <h5 class="text-white text-uppercase mb-3" style="letter-spacing: 2px; font-weight: 600;">Stock Initial (AVEC D√©cote)</h5>
                                                                <div class="display-3 fw-bold text-white mb-3" style="text-shadow: 0 4px 12px rgba(0,0,0,0.3); font-size: 3.5rem;">
                                                                    <field name="current_stock_value" widget="monetary" options="{'currency_field': 'company_currency_id', 'no_symbol': True}"/> FCFA
                                                                </div>
                                                                <div class="d-flex justify-content-center align-items-center gap-3">
                                                                    <span class="badge bg-white text-success px-4 py-2 fs-6" style="border-radius: 50px;">üìâ Valeur R√©elle</span>
                                                                    <span class="badge bg-white bg-opacity-25 text-white px-4 py-2 fs-6" style="border-radius: 50px;">‚úì Selon rotation</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- Valorisation par Entrep√¥t -->
                                                    <div class="col-12">
                                                        <div class="card border-success h-100 shadow">
                                                            <div class="card-header bg-success text-white">
                                                                <h5 class="mb-0"><i class="fa fa-warehouse"></i> üè≠ Valorisation D√©taill√©e par Entrep√¥t</h5>
                                                            </div>
                                                            <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                                                                <field name="warehouse_valuation_html" nolabel="1"/>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Section 2: √âTAT DES STOCKS INVENTORI√âS -->
                                <div class="row mt-4">
                                    <div class="col-12 mb-4">
                                        <div class="card border-primary">
                                            <div class="card-header bg-primary text-white">
                                                <h5 class="mb-0">üìã STOCKS INVENTORI√âS (Dernier Inventaire Valid√©)</h5>
                                            </div>
                                            <div class="card-body">
                                                <div class="row">
                                                    <!-- Card 1: Inventaires Valid√©s CLIQUABLE -->
                                                    <div class="col-12 col-sm-6 col-md-4 col-xl-3 mb-3">
                                                        <div class="card border-primary h-100" style="cursor: pointer;">
                                                            <div class="card-body text-center">
                                                                <div class="fs-3 mb-2">üìã</div>
                                                                <h6 class="card-subtitle mb-2 text-muted">Inventaires (Tous √©tats)</h6>
                                                                <h3 class="card-title mb-0 text-primary">
                                                                    <field name="total_inventories"/>
                                                                </h3>
                                                                <div class="mt-3">
                                                                    <button class="btn btn-outline-primary btn-sm w-100" 
                                                                            name="action_view_inventories" 
                                                                            type="object"
                                                                            t-attf-onclick="event.stopPropagation();">
                                                                        üëÅÔ∏è Voir tout
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- Card 2: Produits R√©f√©renc√©s CLIQUABLE -->
                                                    <div class="col-12 col-sm-6 col-md-4 col-xl-3 mb-3">
                                                        <div class="card border-info h-100" style="cursor: pointer;">
                                                            <div class="card-body text-center" 
                                                                 t-attf-onclick="event.stopPropagation();" 
                                                                 data-oe-model="stockex.inventory.summary" 
                                                                 t-attf-data-oe-id="#{record.id.raw_value}" 
                                                                 data-oe-field="action_view_inventoried_products">
                                                                <div class="fs-3 mb-2">üì¶</div>
                                                                <h6 class="card-subtitle mb-2 text-muted">Produits Inventori√©s</h6>
                                                                <h3 class="card-title mb-0 text-info">
                                                                    <field name="total_products_all" widget="integer"/>
                                                                </h3>
                                                                <small class="badge bg-info-subtle text-info mt-2">R√©f√©rences</small>
                                                                <div class="mt-2">
                                                                    <button class="btn btn-outline-info btn-sm w-100" 
                                                                            name="action_view_inventoried_products" 
                                                                            type="object">
                                                                        üëÅÔ∏è Voir produits
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- Card 3: Quantit√© NON CLIQUABLE -->
                                                    <div class="col-12 col-sm-6 col-md-4 col-xl-3 mb-3">
                                                        <div class="card border-info h-100">
                                                            <div class="card-body text-center">
                                                                <div class="fs-3 mb-2">üìä</div>
                                                                <h6 class="card-subtitle mb-2 text-muted">Quantit√© Totale</h6>
                                                                <h3 class="card-title mb-0 text-info">
                                                                    <field name="total_quantity_all" widget="integer"/>
                                                                </h3>
                                                                <small class="badge bg-info-subtle text-info mt-2">Unit√©s</small>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- Card 4: Valeur Inventori√©e NON CLIQUABLE -->
                                                    <div class="col-12 col-sm-6 col-md-4 col-xl-3 mb-3">
                                                        <div class="card border-warning h-100">
                                                            <div class="card-body text-center">
                                                                <div class="fs-3 mb-2">üíµ</div>
                                                                <h6 class="card-subtitle mb-2 text-muted">Valeur Inventori√©e</h6>
                                                                <h3 class="card-title mb-0 text-warning">
                                                                    <field name="total_value_all" widget="monetary" options="{'currency_field': 'company_currency_id', 'no_symbol': True}"/> FCFA
                                                                </h3>
                                                                <small class="badge bg-warning-subtle text-warning mt-2">Dernier inventaire</small>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Valorisation par Entrep√¥t NON CLIQUABLE -->
                                <div class="row mt-2">
                                    <div class="col-12">
                                        <div class="card border-warning h-100 shadow">
                                            <div class="card-header bg-warning text-dark">
                                                <h5 class="mb-0"><i class="fa fa-warehouse"></i> üè≠ Valorisation Inventori√©e par Entrep√¥t</h5>
                                            </div>
                                            <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                                                <field name="inventoried_warehouse_valuation_html" nolabel="1"/>
                                                <div class="mt-3 d-flex justify-content-end gap-2">
                                                    <button name="action_export_warehouse_valuation_excel" type="object" class="btn btn-success btn-sm">üìä Export Excel</button>
                                                    <button name="action_view_warehouse_details" type="object" class="btn btn-outline-warning btn-sm">üè≠ Voir entrep√¥ts</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Deleted: Carte 'COMPARAISON STOCK ACTUEL vs STOCKS INVENTORI√âS' supprim√©e -->
                                
                                <!-- Section Actions Rapides -->
                                <div class="row mt-5">
                                    <div class="col-12">
                                        <div class="card border">
                                            <div class="card-header bg-light">
                                                <h5 class="mb-0">‚ö° Actions Rapides</h5>
                                            </div>
                                            <div class="card-body p-4">
                                                <div class="row g-3">
                                                    <div class="col-md-4 col-sm-12 mb-3">
                                                        <button class="btn btn-outline-primary btn-lg w-100" 
                                                                name="%(action_import_method_wizard)d" 
                                                                type="action">
                                                            ‚ûï Nouvel Inventaire
                                                        </button>
                                                    </div>
                                                    <div class="col-md-4 col-sm-12 mb-3">
                                                        <button class="btn btn-outline-secondary btn-lg w-100" 
                                                                name="%(action_stockex_inventory)d" 
                                                                type="action">
                                                            üìã Tous les Inventaires
                                                        </button>
                                                    </div>
                                                    <div class="col-md-4 col-sm-12 mb-3">
                                                        <button class="btn btn-outline-info btn-lg w-100" 
                                                                name="action_view_warehouse_details" 
                                                                type="object">
                                                            üè≠ Voir Entrep√¥ts
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                

                                
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>
    

    
</odoo>