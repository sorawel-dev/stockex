<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Action pour la page d'accueil -->
    <record id="action_stockex_dashboard_home" model="ir.actions.act_window">
        <field name="name">Vue d'Ensemble</field>
        <field name="res_model">stockex.inventory.summary</field>
        <field name="view_mode">form</field>
        <field name="res_id" ref="inventory_summary_default"/>
        <field name="target">current</field>
        <field name="context">{'form_view_initial_mode': 'readonly'}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                👋 Bienvenue dans la Gestion d'Inventaire !
            </p>
            <p>
                Créez votre premier inventaire pour commencer à gérer vos stocks.
            </p>
        </field>
    </record>
    
    <!-- Vue Kanban améliorée pour la page d'accueil avec Filtres -->
    <record id="view_inventory_summary_kanban_dashboard" model="ir.ui.view">
        <field name="name">stockex.inventory.summary.kanban.dashboard</field>
        <field name="model">stockex.inventory.summary</field>
        <field name="priority">1</field>
        <field name="arch" type="xml">
            <kanban create="false" edit="false" delete="false" class="o_kanban_dashboard o_stockex_dashboard">
                <field name="total_inventories"/>
                <field name="total_inventories_done"/>
                <field name="total_products_all"/>
                <field name="total_quantity_all"/>
                <field name="total_value_all"/>
                <field name="last_inventory_id"/>
                <field name="last_inventory_date"/>
                <field name="last_inventory_value"/>
                <field name="top_categories_html"/>
                <field name="top_warehouses_html"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click o_stockex_dashboard_main">
                            
                            <!-- Header avec titre -->
                            <div class="o_kanban_card_header mb-3">
                                <div class="o_kanban_card_header_title">
                                    <div class="o_primary">
                                        <h3>📊 Vue d'Ensemble - Gestion d'Inventaire</h3>
                                    </div>
                                    <div class="o_secondary">
                                        Tableau de bord de vos stocks et inventaires
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Cards principales avec statistiques -->
                            <div class="container o_kanban_card_content mt-4">
                                <div class="row">
                                    <!-- Card 1: Inventaires -->
                                    <div class="col-12 col-md-6 col-lg-3 mb-3">
                                        <div class="card bg-primary text-white h-100">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <div>
                                                        <h6 class="card-subtitle mb-2 text-white-50">📋 Inventaires</h6>
                                                        <h2 class="card-title mb-0">
                                                            <field name="total_inventories_done"/>
                                                        </h2>
                                                        <small class="text-white-50">Validés</small>
                                                    </div>
                                                    <div class="fs-1 opacity-25">📋</div>
                                                </div>
                                                <div class="mt-3">
                                                    <button class="btn btn-light btn-sm" 
                                                            name="action_view_inventories" 
                                                            type="object">
                                                        Voir tout
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Card 2: Produits -->
                                    <div class="col-12 col-md-6 col-lg-3 mb-3">
                                        <div class="card bg-success text-white h-100">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <div>
                                                        <h6 class="card-subtitle mb-2 text-white-50">📦 Produits</h6>
                                                        <h2 class="card-title mb-0">
                                                            <field name="total_products_all"/>
                                                        </h2>
                                                        <small class="text-white-50">Références</small>
                                                    </div>
                                                    <div class="fs-1 opacity-25">📦</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Card 3: Quantité -->
                                    <div class="col-12 col-md-6 col-lg-3 mb-3">
                                        <div class="card bg-info text-white h-100">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <div>
                                                        <h6 class="card-subtitle mb-2 text-white-50">📊 Quantité</h6>
                                                        <h2 class="card-title mb-0">
                                                            <field name="total_quantity_all" widget="integer"/>
                                                        </h2>
                                                        <small class="text-white-50">Unités</small>
                                                    </div>
                                                    <div class="fs-1 opacity-25">📊</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Card 4: Valeur -->
                                    <div class="col-12 col-md-6 col-lg-3 mb-3">
                                        <div class="card bg-warning text-dark h-100">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <div>
                                                        <h6 class="card-subtitle mb-2 text-muted">💰 Valeur Totale</h6>
                                                        <h2 class="card-title mb-0">
                                                            <field name="total_value_all" widget="monetary"/>
                                                        </h2>
                                                        <small class="text-muted">Tous stocks</small>
                                                    </div>
                                                    <div class="fs-1 opacity-25">💰</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Section Actions Rapides -->
                                <div class="row mt-4">
                                    <div class="col-12">
                                        <div class="card">
                                            <div class="card-header bg-light">
                                                <h5 class="mb-0">🚀 Actions Rapides</h5>
                                            </div>
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-md-4 mb-2">
                                                        <button class="btn btn-primary btn-block w-100" 
                                                                name="%(action_import_method_wizard)d" 
                                                                type="action">
                                                            📦 Nouvel Inventaire
                                                        </button>
                                                    </div>
                                                    <div class="col-md-4 mb-2">
                                                        <button class="btn btn-secondary btn-block w-100" 
                                                                name="%(action_stockex_inventory)d" 
                                                                type="action">
                                                            📋 Voir les Inventaires
                                                        </button>
                                                    </div>
                                                    <div class="col-md-4 mb-2">
                                                        <button class="btn btn-info btn-block w-100" 
                                                                name="%(action_inventory_analysis)d" 
                                                                type="action">
                                                            📈 Analyse Détaillée
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Section Dernier Inventaire + Analyses -->
                                <div class="row mt-4">
                                    <!-- Dernier Inventaire -->
                                    <div class="col-md-4 mb-3">
                                        <div class="card h-100">
                                            <div class="card-header bg-primary text-white">
                                                <h6 class="mb-0">🔄 Dernier Inventaire</h6>
                                            </div>
                                            <div class="card-body">
                                                <t t-if="record.last_inventory_id.value">
                                                    <dl class="row mb-0">
                                                        <dt class="col-sm-5">Inventaire:</dt>
                                                        <dd class="col-sm-7"><field name="last_inventory_id"/></dd>
                                                        
                                                        <dt class="col-sm-5">Date:</dt>
                                                        <dd class="col-sm-7"><field name="last_inventory_date"/></dd>
                                                        
                                                        <dt class="col-sm-5">Produits:</dt>
                                                        <dd class="col-sm-7"><field name="last_inventory_products"/></dd>
                                                        
                                                        <dt class="col-sm-5">Valeur:</dt>
                                                        <dd class="col-sm-7"><field name="last_inventory_value" widget="monetary"/></dd>
                                                    </dl>
                                                </t>
                                                <t t-else="">
                                                    <p class="text-muted text-center mb-0">
                                                        Aucun inventaire validé
                                                    </p>
                                                </t>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Top Catégories -->
                                    <div class="col-md-4 mb-3">
                                        <div class="card h-100">
                                            <div class="card-header bg-success text-white">
                                                <h6 class="mb-0">📊 Top 5 Catégories</h6>
                                            </div>
                                            <div class="card-body p-2" style="max-height: 300px; overflow-y: auto;">
                                                <field name="top_categories_html" nolabel="1"/>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Top Entrepôts -->
                                    <div class="col-md-4 mb-3">
                                        <div class="card h-100">
                                            <div class="card-header bg-info text-white">
                                                <h6 class="mb-0">🏭 Top 5 Entrepôts</h6>
                                            </div>
                                            <div class="card-body p-2" style="max-height: 300px; overflow-y: auto;">
                                                <field name="top_warehouses_html" nolabel="1"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>
    
</odoo>
