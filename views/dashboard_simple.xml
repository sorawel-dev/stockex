<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Vue Kanban enrichie pour le dashboard -->
        <record id="view_inventory_dashboard_simple" model="ir.ui.view">
            <field name="name">stockex.dashboard.simple</field>
            <field name="model">stockex.inventory.summary</field>
            <field name="priority">1</field>
            <field name="arch" type="xml">
                <kanban create="false" edit="false" delete="false" class="o_kanban_dashboard o_stockex_dashboard">
                    <field name="total_inventories"/>
                    <field name="total_inventories_done"/>
                    <field name="total_products_all"/>
                    <field name="total_quantity_all"/>
                    <field name="total_value_all"/>
                    <field name="current_stock_value"/>
                    <field name="company_currency_id"/>
                    <field name="initial_stock_analysis_html"/>
                    <field name="initial_stock_total_value"/>
                    <field name="initial_stock_products_count"/>
                    <field name="last_inventory_date"/>
                    <field name="initial_stock_date"/>
                    <templates>
                        <t t-name="card">
                            <div class="container-fluid p-3">
                                <!-- Titre du Dashboard -->
                                <div class="row mb-4">
                                    <div class="col-12">
                                        <div class="card shadow-sm border-0" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                            <div class="card-body text-white p-4">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <div>
                                                        <h3 class="mb-1 fw-bold">üìä Tableau de Bord Stock Initial</h3>
                                                        <p class="mb-0 opacity-75">
                                                            <t t-if="record.last_inventory_date.raw_value">
                                                                Dernier inventaire : <strong><t t-esc="record.last_inventory_date.value"/></strong>
                                                            </t>
                                                            <t t-else="">
                                                                Aucun inventaire disponible
                                                            </t>
                                                        </p>
                                                    </div>
                                                    <div class="text-end">
                                                        <i class="fa fa-chart-line fa-3x opacity-50"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Filtres -->
                                <div class="row mb-3">
                                    <div class="col-12">
                                        <div class="card shadow-sm">
                                            <div class="card-body p-3">
                                                <div class="row g-2">
                                                    <div class="col-md-3">
                                                        <div class="o_form_label small text-muted mb-1">üìÖ P√©riode</div>
                                                        <field name="period_filter" widget="selection" class="form-select form-select-sm"/>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="o_form_label small text-muted mb-1">üè≠ Entrep√¥ts</div>
                                                        <field name="warehouse_ids" widget="many2many_tags" options="{'no_create': true}" class="form-control form-control-sm"/>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="o_form_label small text-muted mb-1">üìÅ Cat√©gories</div>
                                                        <field name="category_ids" widget="many2many_tags" options="{'no_create': true}" class="form-control form-control-sm"/>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="o_form_label small text-muted mb-1">üìä √âcarts</div>
                                                        <field name="show_differences" widget="selection" class="form-select form-select-sm"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- KPIs sup√©rieurs -->
                                <div class="row mb-4">
                                    <!-- Valeur du stock -->
                                    <div class="col mb-3">
                                        <div class="card h-100 text-white bg-primary border-0 shadow-sm">
                                            <div class="card-body p-3">
                                                <div class="d-flex justify-content-between align-items-start mb-2">
                                                    <div>
                                                        <h6 class="card-title mb-1" style="font-size: 0.9rem; font-weight: bold;">Valeur du stock</h6>
                                                        <small class="opacity-75">Total (FCFA)</small>
                                                    </div>
                                                    <div class="rounded-circle p-2" style="background: rgba(255,255,255,0.2);">
                                                        <i class="fa fa-wallet fs-1"></i>
                                                    </div>
                                                </div>
                                                <h4 class="mb-0 mt-1 card-title">
                                                    <field name="current_stock_value" widget="monetary" options="{'currency_field': 'company_currency_id'}"/>
                                                </h4>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- √âcart inventaire -->
                                    <div class="col mb-3">
                                        <div class="card h-100 text-white bg-warning border-0 shadow-sm">
                                            <div class="card-body p-3">
                                                <div class="d-flex justify-content-between align-items-start mb-2">
                                                    <div>
                                                        <h6 class="card-title mb-1" style="font-size: 0.9rem; font-weight: bold;">√âcart inventaire</h6>
                                                        <small class="opacity-75">Rouge si ‚â• 10 000 ou ‚â• 2%</small>
                                                    </div>
                                                    <div class="rounded-circle p-2" style="background: rgba(255,255,255,0.2);">
                                                        <i class="fa fa-exclamation-triangle fs-1"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Pr√©cision -->
                                    <div class="col mb-3">
                                        <div class="card h-100 text-white bg-success border-0 shadow-sm">
                                            <div class="card-body p-3">
                                                <div class="d-flex justify-content-between align-items-start mb-2">
                                                    <div>
                                                        <h6 class="card-title mb-1" style="font-size: 0.9rem; font-weight: bold;">Pr√©cision</h6>
                                                        <small class="opacity-75">Vert si ‚â• objectif</small>
                                                    </div>
                                                    <div class="rounded-circle p-2" style="background: rgba(255,255,255,0.2);">
                                                        <i class="fa fa-bullseye fs-1"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Obsolescence -->
                                    <div class="col mb-3">
                                        <div class="card h-100 text-white bg-info border-0 shadow-sm">
                                            <div class="card-body p-3">
                                                <div class="d-flex justify-content-between align-items-start mb-2">
                                                    <div>
                                                        <h6 class="card-title mb-1" style="font-size: 0.9rem; font-weight: bold;">Obsolescence</h6>
                                                        <small class="opacity-75">Rotation lente / stock mort</small>
                                                    </div>
                                                    <div class="rounded-circle p-2" style="background: rgba(255,255,255,0.2);">
                                                        <i class="fa fa-hourglass-half fs-1"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- √âcarts critiques -->
                                    <div class="col mb-3">
                                        <div class="card h-100 text-white bg-danger border-0 shadow-sm">
                                            <div class="card-body p-3">
                                                <div class="d-flex justify-content-between align-items-start mb-2">
                                                    <div>
                                                        <h6 class="card-title mb-1" style="font-size: 0.9rem; font-weight: bold;">√âcarts critiques</h6>
                                                        <small class="opacity-75">Seuil: 10 000 + 2%</small>
                                                    </div>
                                                    <div class="rounded-circle p-2" style="background: rgba(255,255,255,0.2);">
                                                        <i class="fa fa-bolt fs-1"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Graphiques -->
                                <div class="row mb-4">
                                    <!-- √âcarts par entrep√¥t -->
                                    <div class="col-lg-8 mb-3">
                                        <div class="card h-100">
                                            <div class="card-header bg-primary text-white">
                                                <h5 class="mb-0">√âcarts par entrep√¥t (barres)</h5>
                                            </div>
                                            <div class="card-body">
                                                <canvas id="warehouseChart" style="height: 320px; max-height: 320px;"></canvas>
                                                <div class="mt-3 d-flex justify-content-around">
                                                    <div class="text-center p-2" style="background-color: #f8d7da; min-width: 100px; border-radius: 5px;">
                                                        <small>Entrep√¥t 1</small>
                                                    </div>
                                                    <div class="text-center p-2" style="background-color: #e8e8e8; min-width: 100px; border-radius: 5px;">
                                                        <small>Entrep√¥t 2</small>
                                                    </div>
                                                    <div class="text-center p-2" style="background-color: #e8e8e8; min-width: 100px; border-radius: 5px;">
                                                        <small>Entrep√¥t 3</small>
                                                    </div>
                                                    <div class="text-center p-2" style="background-color: #f8d7da; min-width: 100px; border-radius: 5px;">
                                                        <small>Entrep√¥t 4</small>
                                                    </div>
                                                    <div class="text-center p-2" style="background-color: #e8e8e8; min-width: 100px; border-radius: 5px;">
                                                        <small>Entrep√¥t 5</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Valeur par famille -->
                                    <div class="col-lg-4 mb-3">
                                        <div class="card h-100">
                                            <div class="card-header bg-info text-white">
                                                <h5 class="mb-0">Valeur par famille (donut)</h5>
                                            </div>
                                            <div class="card-body text-center">
                                                <canvas id="familyChart" style="height: 320px; max-height: 320px;"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Sections conditionnelles -->
                                <div class="row" t-if="record.initial_stock_analysis_html.raw_value">
                                    <!-- Analyse stock initial -->
                                    <div class="col-12 mb-3">
                                        <div class="card border-0 shadow">
                                            <div class="card-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <h5 class="mb-0 text-white">
                                                        <i class="fa fa-chart-bar me-2"></i>
                                                        üìä Analyse Stock Initial
                                                    </h5>
                                                    <span class="text-white opacity-75" t-if="record.initial_stock_date.raw_value">
                                                        <small>üìÖ Stock du <strong t-esc="record.initial_stock_date.value"/></small>
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="card-body p-0">
                                                <field name="initial_stock_analysis_html" widget="html" nolabel="1"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Sections valorisation -->
                                <div class="row">
                                    <!-- Stock initial -->
                                    <div class="col-lg-6 mb-3">
                                        <div class="card h-100 border-0 shadow-sm" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                                            <div class="card-body p-4 text-white">
                                                <div class="d-flex justify-content-between align-items-start mb-3">
                                                    <div>
                                                        <h5 class="mb-1" style="font-weight: 700;">Stock initial (sans d√©cote)</h5>
                                                        <small class="opacity-75">Valorisation standard</small>
                                                    </div>
                                                    <div class="rounded-circle p-3" style="background: rgba(255,255,255,0.2);">
                                                        <i class="fa fa-warehouse fs-3"></i>
                                                    </div>
                                                </div>
                                                <p class="mb-0 opacity-90">Affich√© en pleine largeur si valorisation standard</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- D√©cote √©conomique -->
                                    <div class="col-lg-6 mb-3">
                                        <div class="card h-100 border-0 shadow-sm" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                                            <div class="card-body p-4 text-white">
                                                <div class="d-flex justify-content-between align-items-start mb-3">
                                                    <div>
                                                        <h5 class="mb-1" style="font-weight: 700;">D√©cote √©conomique</h5>
                                                        <small class="opacity-75">Selon rotation stock</small>
                                                    </div>
                                                    <div class="rounded-circle p-3" style="background: rgba(255,255,255,0.2);">
                                                        <i class="fa fa-chart-line fs-3"></i>
                                                    </div>
                                                </div>
                                                <p class="mb-0 opacity-90">Affich√© en parall√®le si valorisation √©conomique</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Boutons d'action -->
                                <div class="row mt-3">
                                    <div class="col-12">
                                        <button class="btn btn-primary" name="action_view_inventories" type="object">
                                            üìã Voir tous les inventaires
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Script Chart.js simplifi√© -->
                            <script>
                                // Graphique des √©carts par entrep√¥t (simulation)
                                if (document.getElementById('warehouseChart')) {
                                    var ctx1 = document.getElementById('warehouseChart').getContext('2d');
                                    // Le graphique sera initialis√© via JavaScript externe
                                }
                                
                                // Graphique circulaire par famille (simulation)
                                if (document.getElementById('familyChart')) {
                                    var ctx2 = document.getElementById('familyChart').getContext('2d');
                                    // Le graphique sera initialis√© via JavaScript externe
                                }
                            </script>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>
        
        <!-- Action pour le dashboard simplifi√© -->
        <record id="action_stockex_dashboard_simple" model="ir.actions.act_window">
            <field name="name">Vue d'Ensemble</field>
            <field name="res_model">stockex.inventory.summary</field>
            <field name="view_mode">kanban</field>
            <field name="view_id" ref="view_inventory_dashboard_simple"/>
            <field name="context">{'form_view_initial_mode': 'readonly'}</field>
        </record>
    </data>
</odoo>
