<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- Vue formulaire h√©rit√©e pour ajouter les champs personnalis√©s -->
    <record id="view_warehouse_form_inherit" model="ir.ui.view">
        <field name="name">stock.warehouse.form.inherit</field>
        <field name="model">stock.warehouse</field>
        <field name="inherit_id" ref="stock.view_warehouse"/>
        <field name="arch" type="xml">
            
            <!-- Smart buttons int√©gr√©s dans le button_box -->
            <xpath expr="//div[@name='button_box']" position="inside">
                <button name="action_open_stock_value" type="object" class="oe_stat_button" icon="fa-money-bill-wave">
                    <div class="o_field_widget o_stat_info">
                        <span class="o_stat_value" style="color: #28a745;">
                            <field name="stock_value_fcfa" widget="integer"/> FCFA
                        </span>
                        <span class="o_stat_text">Valeur du stock</span>
                    </div>
                </button>
                <button name="action_open_moves" type="object" class="oe_stat_button" icon="fa-exchange-alt">
                    <div class="o_field_widget o_stat_info">
                        <span class="o_stat_value" style="color: #17a2b8;">
                            <field name="move_count"/>
                        </span>
                        <span class="o_stat_text">Mouvements</span>
                    </div>
                </button>
                <button name="action_open_quants" type="object" class="oe_stat_button" icon="fa-boxes">
                    <div class="o_field_widget o_stat_info">
                        <span class="o_stat_value" style="color: #6c757d;">
                            <field name="quant_count"/>
                        </span>
                        <span class="o_stat_text">Articles en stock</span>
                    </div>
                </button>
            </xpath>
            
            <!-- Ajouter les champs r√©partis entre 2 colonnes -->
            <xpath expr="//field[@name='code']" position="after">
                <field name="warehouse_code" 
                       placeholder="Ex: WH-ABJ-001"
                       help="Code unique de l'entrep√¥t (optionnel)"/>
                <field name="parent_id" options="{'no_create': True}"/>
                <field name="parent_name_upper" 
                       readonly="1"
                       invisible="not parent_id"
                       class="text-uppercase fw-bold"
                       style="font-weight: bold; font-size: 14px;"/>
            </xpath>
            
            <!-- Ajouter champs dans la 2√®me colonne -->
            <xpath expr="//sheet/group/group[2]" position="inside">
                <field name="warehouse_type"/>
                <field name="eneo_region_id" options="{'no_create': True}"/>
            </xpath>
            
            <!-- Ajouter un onglet G√©olocalisation -->
            <xpath expr="//notebook" position="inside">
                <page string="üìç G√©olocalisation" name="geolocation">
                    <group>
                        <group string="Coordonn√©es GPS">
                            <field name="latitude"/>
                            <field name="longitude"/>
                            <field name="coordinates" readonly="1"/>
                            <button name="action_open_map" 
                                    string="üìç Voir sur Google Maps" 
                                    type="object" 
                                    class="btn-primary"
                                    invisible="not latitude or not longitude"/>
                        </group>
                        <group string="Informations de Contact">
                            <field name="city" placeholder="Ville"/>
                            <field name="address" placeholder="Adresse compl√®te..."/>
                            <field name="phone" widget="phone" placeholder="+225 XX XX XX XX XX"/>
                            <field name="email" widget="email" placeholder="contact@entrepot.com"/>
                        </group>
                    </group>
                </page>
            </xpath>
            
            <!-- Ajouter un onglet Entrep√¥ts Enfants -->
            <xpath expr="//notebook" position="inside">
                <page string="üè¢ Entrep√¥ts Enfants" name="children" invisible="child_count == 0">
                    <field name="child_ids" readonly="1">
                        <list>
                            <field name="name"/>
                            <field name="code" string="Diminutif"/>
                            <field name="warehouse_code" optional="show"/>
                            <field name="warehouse_type" optional="show"/>
                            <field name="city" optional="show"/>
                            <field name="coordinates" optional="show"/>
                        </list>
                    </field>
                </page>
            </xpath>
            
            <!-- Ajouter le compteur d'enfants (invisible) -->
            <xpath expr="//field[@name='code']" position="before">
                <field name="child_count" invisible="1"/>
            </xpath>
            
        </field>
    </record>
    
    <!-- Vue liste h√©rit√©e pour afficher les nouveaux champs -->
    <record id="view_warehouse_tree_inherit" model="ir.ui.view">
        <field name="name">stock.warehouse.list.inherit</field>
        <field name="model">stock.warehouse</field>
        <field name="inherit_id" ref="stock.view_warehouse_tree"/>
        <field name="arch" type="xml">
            <field name="name" position="after">
                <field name="code" string="Diminutif" optional="show"/>
                <field name="warehouse_code" optional="show" string="Code Entrep√¥t"/>
                <field name="warehouse_type" optional="show"/>
                <field name="eneo_region_id" optional="show"/>
                <field name="parent_name_upper" optional="show" string="Magasin Parent" class="fw-bold"/>
                <field name="parent_id" optional="hide"/>
                <field name="city" optional="show"/>
                <field name="coordinates" optional="hide"/>
                <field name="child_count" optional="hide"/>
            </field>
        </field>
    </record>
    
    <!-- Action pour les entrep√¥ts -->
    <record id="action_warehouse_stockex" model="ir.actions.act_window">
        <field name="name">Entrep√¥ts</field>
        <field name="res_model">stock.warehouse</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="search_view_id" ref="view_warehouse_search_stockex"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Cr√©er un nouvel entrep√¥t
            </p>
            <p>
                Les entrep√¥ts peuvent √™tre organis√©s de mani√®re hi√©rarchique et g√©olocalis√©s.
            </p>
        </field>
    </record>
    
    <!-- Vue recherche pour Entrep√¥ts (standalone) -->
    <record id="view_warehouse_kanban_stockex" model="ir.ui.view">
        <field name="name">stock.warehouse.kanban.stockex</field>
        <field name="model">stock.warehouse</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile">
                <field name="id"/>
                <field name="name"/>
                <field name="code"/>
                <field name="stock_value_fcfa"/>
                <field name="city"/>
                <field name="warehouse_type"/>
                <field name="eneo_region_id"/>
                <field name="quant_count"/>
                <field name="product_ref_count"/>
                <field name="move_count"/>
                <field name="color"/>
                <field name="eneo_network"/>
                <templates>
                    <t t-name="card">
                        <div class="oe_kanban_card oe_kanban_global_click rounded" t-att-class="(record.eneo_network &amp;&amp; record.eneo_network.raw_value === 'south') ? 'bg-light border-start border-3 border-success' : 'bg-light border-start border-3 border-info'">
                            <div class="o_dropdown_kanban dropdown">
                                <a class="dropdown-toggle o-no-caret btn" role="button" data-bs-toggle="dropdown" href="#" aria-label="Dropdown menu" title="Menu">
                                    <span class="fa fa-ellipsis-v"/>
                                </a>
                                <div class="dropdown-menu" role="menu">
                                    <a role="menuitem" type="open" class="dropdown-item">Ouvrir</a>
                                    <a role="menuitem" type="edit" class="dropdown-item">Modifier</a>
                                </div>
                            </div>
                            <div class="oe_kanban_content px-3 py-1 position-relative">
                                <!-- Image en filigrane -->
                                <img src="/stockex/static/description/warehouse_watermark.svg" 
                                     class="position-absolute opacity-25" 
                                     style="width: 120px; height: 120px; right: -10px; top: 50%; transform: translateY(-50%); z-index: 0; object-fit: contain;"
                                     alt="Entrep√¥t"/>
                                <div class="oe_kanban_card_header position-relative" style="z-index: 1;">
                                    <div class="oe_kanban_card_header_title mb-0">
                                        <span class="fa fa-warehouse fa-lg text-primary me-1" title="Entrep√¥t"/> <strong><field name="code" string="Diminutif"/></strong> - <field name="name"/>
                                    </div>
                                </div>
                                <div class="oe_kanban_card_body position-relative" style="z-index: 1;">
                                    <!-- Ville avec ic√¥ne color√©e -->
                                    <div class="mb-0">
                                        <i class="fa fa-map-marker-alt fa-lg text-warning me-1" title="Localisation"/> 
                                        <span t-if="record.city.raw_value"><field name="city"/></span>
                                        <span t-else="" class="text-muted">Non renseign√©e</span>
                                    </div>
                                    <!-- Valeur du stock avec libell√© -->
                                    <div class="mb-0">
                                        <i class="fa fa-money-bill-wave fa-lg text-success me-1"/> 
                                        <strong>Valeur stock:</strong> <span t-esc="((record.stock_value_fcfa &amp;&amp; record.stock_value_fcfa.raw_value) ? record.stock_value_fcfa.raw_value : 0).toFixed(0)"/> FCFA
                                    </div>
                                    <!-- Badges compacts: Articles en stock, Mouvements -->
                                    <div class="d-flex gap-1 mb-0">
                                        <span class="badge rounded-pill text-bg-primary" title="Articles en stock (quantit√©s > 0)">
                                            <i class="fa fa-boxes me-1" title="Articles en stock"/> <field name="quant_count"/> art.
                                        </span>
                                        <span class="badge rounded-pill text-bg-info" title="Nombre total de mouvements">
                                            <i class="fa fa-exchange-alt me-1" title="Mouvements"/> <field name="move_count"/>
                                        </span>
                                    </div>
                                    <!-- Type de magasin -->
                                    <div class="mb-0">
                                        <i class="fa fa-warehouse text-muted me-1"/> <field name="warehouse_type"/>
                                    </div>
                                    <!-- R√©seau √©lectrique ENEO -->
                                    <div class="mb-0">
                                        <i class="fa fa-bolt text-primary me-1" title="R√©seau √©lectrique"/> 
                                        <span t-if="record.eneo_network.raw_value == 'south'" class="badge bg-success">RIS</span>
                                        <span t-if="record.eneo_network.raw_value == 'north'" class="badge bg-info">RIN</span>
                                    </div>
                                    <!-- R√©gion √©lectrique avec nouvelle ic√¥ne -->
                                    <div class="mb-0">
                                        <i class="fa fa-plug text-warning me-1" title="R√©gion √©lectrique ENEO"/> <field name="eneo_region_id"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>
    
    
    <!-- Vue recherche pour Entrep√¥ts (filtres pertinents) -->
    <record id="view_warehouse_search_stockex" model="ir.ui.view">
        <field name="name">stock.warehouse.search.stockex</field>
        <field name="model">stock.warehouse</field>
        <field name="arch" type="xml">
            <search string="Recherche Entrep√¥ts">
                <field name="name"/>
                <field name="code" string="Diminutif"/>
                <field name="warehouse_code"/>
                <field name="city"/>
                <field name="warehouse_type"/>
                <field name="eneo_region_id"/>
                <field name="parent_id"/>
                <field name="eneo_network"/>

                <separator/>
                <filter string="üè† Racine (sans parent)" name="root_only" domain="[('parent_id','=',False)]"/>
                <filter string="üë∂ Avec enfants" name="with_children" domain="[('child_count','>',0)]"/>

                <separator/>
                <filter string="‚ö° R√©seau Sud (RIS)" name="network_south" domain="[('eneo_network','=','south')]"/>
                <filter string="‚ö° R√©seau Nord (RIN)" name="network_north" domain="[('eneo_network','=','north')]"/>

                <separator/>
                <filter string="üè∑Ô∏è Type" name="group_type" context="{'group_by':'warehouse_type'}"/>
                <filter string="üîå R√©gion √âlectrique ENEO" name="group_region" context="{'group_by':'eneo_region_id'}"/>
                <filter string="üë™ Parent" name="group_parent" context="{'group_by':'parent_id'}"/>
                <filter string="‚ö° R√©seau ENEO" name="group_network" context="{'group_by':'eneo_network'}"/>
                <filter string="üèôÔ∏è Ville" name="group_city" context="{'group_by':'city'}"/>
            </search>
        </field>
    </record>

</odoo>
